From 327f8273363c3a82dd2fa498cbcd81e01b6e22f4 Mon Sep 17 00:00:00 2001
From: Jens Trillmann <jens.trillmann@governikus.de>
Date: Thu, 16 Oct 2025 18:06:53 +0200
Subject: A11y: Implement QAccessibleEditableTextInterface for TextInput

Change-Id: I211278ec3ec32554abcd163933bdf2156183d27c
---
 src/quick/accessible/qaccessiblequickitem.cpp | 23 +++++++++++++++
 src/quick/accessible/qaccessiblequickitem_p.h |  6 ++++
 .../accessible/qaccessiblequicktextedit.cpp   |  1 +
 .../accessible/qaccessiblequicktextinput.cpp  | 28 +++++++++++++++++++
 .../accessible/qaccessiblequicktextinput_p.h  |  4 +++
 5 files changed, 62 insertions(+)

diff --git x/qtdeclarative/src/quick/accessible/qaccessiblequickitem.cpp y/qtdeclarative/src/quick/accessible/qaccessiblequickitem.cpp
index b2b8ddd84666bf1f1aceaad23c8d0dcc79c0cf7b..fb7c3237d2d8db37a553e67dd68d06e115b80141 100644
--- x/qtdeclarative/src/quick/accessible/qaccessiblequickitem.cpp
+++ y/qtdeclarative/src/quick/accessible/qaccessiblequickitem.cpp
@@ -657,6 +657,12 @@ void *QAccessibleQuickItem::interface_cast(QAccessible::InterfaceType t)
             r == QAccessible::ProgressBar))
        return static_cast<QAccessibleValueInterface*>(this);
 
+    if (t == QAccessible::EditableTextInterface) {
+        if (r == QAccessible::EditableText) {
+            return static_cast<QAccessibleEditableTextInterface*>(this);
+        }
+    }
+
     if (t == QAccessible::TextInterface) {
         if (r == QAccessible::EditableText ||
             r == QAccessible::StaticText)
@@ -960,6 +966,23 @@ void QAccessibleQuickItem::setSelection(int /* selectionIndex */, int /* startOf
 
 }
 
+void QAccessibleQuickItem::deleteText(int /* startOffset */, int /* endOffset */)
+{
+
+}
+
+
+void QAccessibleQuickItem::insertText(int /* offset */, const QString &/* text */)
+{
+
+}
+
+
+void QAccessibleQuickItem::replaceText(int /* startOffset */, int /* endOffset */, const QString &/* text */)
+{
+
+}
+
 
 #endif // accessibility
 
diff --git x/qtdeclarative/src/quick/accessible/qaccessiblequickitem_p.h y/qtdeclarative/src/quick/accessible/qaccessiblequickitem_p.h
index 33b4e6476c8c093767f8b4b07621988b3a1f59e3..ea9d1c2ac1e7097ba0e1f52cc63481217e92fea8 100644
--- x/qtdeclarative/src/quick/accessible/qaccessiblequickitem_p.h
+++ y/qtdeclarative/src/quick/accessible/qaccessiblequickitem_p.h
@@ -30,6 +30,7 @@ class Q_QUICK_EXPORT QAccessibleQuickItem : public QAccessibleObject,
                                             public QAccessibleActionInterface,
                                             public QAccessibleValueInterface,
                                             public QAccessibleTextInterface,
+                                            public QAccessibleEditableTextInterface,
                                             public QAccessibleScrollInterface
 {
 public:
@@ -84,6 +85,11 @@ public:
     void removeSelection(int selectionIndex) override;
     void setSelection(int selectionIndex, int startOffset, int endOffset) override;
 
+    // Editable Text Interface
+    void deleteText(int startOffset, int endOffset) override;
+    void insertText(int offset, const QString &text) override;
+    void replaceText(int startOffset, int endOffset, const QString &text) override;
+
     // cursor
     int cursorPosition() const override;
     void setCursorPosition(int position) override;
diff --git x/qtdeclarative/src/quick/accessible/qaccessiblequicktextedit.cpp y/qtdeclarative/src/quick/accessible/qaccessiblequicktextedit.cpp
index 780d69cf9b53f4527725e9eddc494b163b576c70..09dd85597092834d5b3aeda062f7503b86e34baf 100644
--- x/qtdeclarative/src/quick/accessible/qaccessiblequicktextedit.cpp
+++ y/qtdeclarative/src/quick/accessible/qaccessiblequicktextedit.cpp
@@ -26,6 +26,7 @@ void QAccessibleQuickTextEdit::setSelection(int selectionIndex, int startOffset,
         textEdit()->select(startOffset, endOffset);
 }
 
+
 #endif // accessibility
 
 QT_END_NAMESPACE
diff --git x/qtdeclarative/src/quick/accessible/qaccessiblequicktextinput.cpp y/qtdeclarative/src/quick/accessible/qaccessiblequicktextinput.cpp
index 23132e0cedc2e11d8f658bc6b61de0a71332d5b7..32ff8a9675346cb944050090b595c6121736afcf 100644
--- x/qtdeclarative/src/quick/accessible/qaccessiblequicktextinput.cpp
+++ y/qtdeclarative/src/quick/accessible/qaccessiblequicktextinput.cpp
@@ -26,6 +26,34 @@ void QAccessibleQuickTextInput::setSelection(int selectionIndex, int startOffset
         textInput()->select(startOffset, endOffset);
 }
 
+void QAccessibleQuickTextInput::deleteText(int startOffset, int endOffset)
+{
+    if (startOffset >= 0 && startOffset <= textInput()->length()
+        && endOffset >= 0 && endOffset <= textInput()->length()) {
+        textInput()->deselect();
+        textInput()->remove(startOffset, endOffset);
+    }
+}
+
+void QAccessibleQuickTextInput::insertText(int offset, const QString &text)
+{
+    if (offset >= 0 && offset <= textInput()->length()) {
+        textInput()->deselect();
+        textInput()->insert(offset, text);
+    }
+}
+
+void QAccessibleQuickTextInput::replaceText(int startOffset, int endOffset, const QString &text)
+{
+    if (startOffset >= 0 && startOffset <= textInput()->length()
+        && endOffset >= 0 && endOffset <= textInput()->length()
+        && !text.isEmpty()) {
+        textInput()->deselect();
+        textInput()->remove(startOffset, endOffset);
+        textInput()->insert(startOffset, text);
+    }
+}
+
 #endif // accessibility
 
 QT_END_NAMESPACE
diff --git x/qtdeclarative/src/quick/accessible/qaccessiblequicktextinput_p.h y/qtdeclarative/src/quick/accessible/qaccessiblequicktextinput_p.h
index 1ba46f0f601d087b839e320b480f2fd5379b9ec8..b4571aa7cf47d450e65256b91ee5d2ba2eb4ef9f 100644
--- x/qtdeclarative/src/quick/accessible/qaccessiblequicktextinput_p.h
+++ y/qtdeclarative/src/quick/accessible/qaccessiblequicktextinput_p.h
@@ -31,6 +31,10 @@ public:
     void removeSelection(int selectionIndex) override;
     void setSelection(int selectionIndex, int startOffset, int endOffset) override;
 
+    void deleteText(int startOffset, int endOffset) override;
+    void insertText(int offset, const QString &text) override;
+    void replaceText(int startOffset, int endOffset, const QString &text) override;
+
 private:
     QQuickTextInput *textInput() const { return static_cast<QQuickTextInput *>(item()); }
 };
