From 9e7c811ae4a53fdfc7dbd2752e03d214b140222e Mon Sep 17 00:00:00 2001
From: Even Oscar Andersen <even.oscar.andersen@qt.io>
Date: Tue, 4 Mar 2025 13:52:05 +0100
Subject: Implement minimum/maximum-value also for to/from properties
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Some objects have to,from properties instead of minimumValue,
maximumValue properties.

Switch to to,from if minimum,maximum-Value does not exist

Change-Id: Ibb8e2ae3214c5fe654420a5b338d66e8fdae8c6e
Reviewed-by: Jan Arve SÃ¦ther <jan-arve.saether@qt.io>
(cherry picked from commit 3b6701011b6889bc9e1d0863775272098ccdc58a)
---
 src/quick/accessible/qaccessiblequickitem.cpp | 26 +++++++++-
 .../quickcontrols/accessibility/data/item.qml | 52 +++++++++++++++++++
 .../accessibility/tst_accessibility.cpp       | 50 ++++++++++++++++++
 3 files changed, 126 insertions(+), 2 deletions(-)
 create mode 100644 tests/auto/quickcontrols/accessibility/data/item.qml

diff --git x/qtdeclarative/src/quick/accessible/qaccessiblequickitem.cpp y/qtdeclarative/src/quick/accessible/qaccessiblequickitem.cpp
index 494ada3e5d7a51f827a242b8397eee49509ee9bd..c0f6b42425198af7aac30040c28d4e1a230c96c6 100644
--- x/qtdeclarative/src/quick/accessible/qaccessiblequickitem.cpp
+++ y/qtdeclarative/src/quick/accessible/qaccessiblequickitem.cpp
@@ -712,12 +712,34 @@ void QAccessibleQuickItem::setCurrentValue(const QVariant &value)
 
 QVariant QAccessibleQuickItem::maximumValue() const
 {
-    return item()->property("maximumValue");
+    const auto minimumValue = item()->property("minimumValue");
+    const auto maximumValue = item()->property("maximumValue");
+    const auto from = item()->property("from");
+    const auto to   = item()->property("to");
+
+    if (minimumValue.isValid() && maximumValue.isValid())
+        return maximumValue;
+
+    if (from.isValid() && to.isValid())
+        return to;
+
+    return QVariant();
 }
 
 QVariant QAccessibleQuickItem::minimumValue() const
 {
-    return item()->property("minimumValue");
+    const auto minimumValue = item()->property("minimumValue");
+    const auto maximumValue = item()->property("maximumValue");
+    const auto from = item()->property("from");
+    const auto to   = item()->property("to");
+
+    if (minimumValue.isValid() && maximumValue.isValid())
+        return minimumValue;
+
+    if (from.isValid() && to.isValid())
+        return from;
+
+    return QVariant();
 }
 
 QVariant QAccessibleQuickItem::minimumStepSize() const
diff --git x/qtdeclarative/tests/auto/quickcontrols/accessibility/data/item.qml y/qtdeclarative/tests/auto/quickcontrols/accessibility/data/item.qml
new file mode 100644
index 0000000000000000000000000000000000000000..800843b0cf74c1ed3339617272804d40852516da
--- /dev/null
+++ y/qtdeclarative/tests/auto/quickcontrols/accessibility/data/item.qml
@@ -0,0 +1,52 @@
+// Copyright (C) 2025 The Qt Company Ltd.
+// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR GPL-3.0-only
+
+import QtQuick
+import QtQuick.Controls
+Item {
+    Accessible.role: Accessible.Client
+    Item {
+        id: item1
+        property double stepSize: 0
+        property double from: 0
+        property double to: 100
+        property double value: 25
+        Accessible.role: Accessible.Slider
+        Accessible.onDecreaseAction: { value -= stepSize; }
+        Accessible.onIncreaseAction: { value += stepSize; }
+    }
+    Item {
+        id: item2
+        property double stepSize: 5
+        property double from: 0
+        property double to: 100
+        property double value: 25
+        Accessible.role: Accessible.Slider
+        Accessible.onDecreaseAction: { value -= stepSize; }
+        Accessible.onIncreaseAction: { value += stepSize; }
+    }
+    Item {
+        id: item3
+        property double stepSize: 0
+        property double minimumValue: 0
+        property double maximumValue: 100
+        property double from: -1000
+        property double to: 1000
+        property double value: 25
+        Accessible.role: Accessible.Slider
+        Accessible.onDecreaseAction: { value -= stepSize; }
+        Accessible.onIncreaseAction: { value += stepSize; }
+    }
+    Item {
+        id: item4
+        property double stepSize: 5
+        property double minimumValue: 0
+        property double maximumValue: 100
+        property double from: -1000
+        property double to: 1000
+        property double value: 25
+        Accessible.role: Accessible.Slider
+        Accessible.onDecreaseAction: { value -= stepSize; }
+        Accessible.onIncreaseAction: { value += stepSize; }
+    }
+}
diff --git x/qtdeclarative/tests/auto/quickcontrols/accessibility/tst_accessibility.cpp y/qtdeclarative/tests/auto/quickcontrols/accessibility/tst_accessibility.cpp
index e2eb3d7f8be02de1fbedcbe2b27a81d2a9d53fe7..c7474a73f1eb22f5060505e55b10e4148397ae7b 100644
--- x/qtdeclarative/tests/auto/quickcontrols/accessibility/tst_accessibility.cpp
+++ y/qtdeclarative/tests/auto/quickcontrols/accessibility/tst_accessibility.cpp
@@ -36,6 +36,7 @@ private slots:
     void actionAccessibilityImplicitName();
 
     void accessibleName();
+    void sliderTest();
 private:
     QQmlEngine engine;
 };
@@ -376,6 +377,55 @@ void tst_accessibility::accessibleName()
 #endif
 }
 
+void tst_accessibility::sliderTest()
+{
+#if QT_CONFIG(accessibility)
+    if (!QAccessible::isActive()) {
+        QPlatformAccessibility *accessibility = platformAccessibility();
+        if (!accessibility)
+            QSKIP("No QPlatformAccessibility available.");
+        accessibility->setActive(true);
+    }
+
+    QQmlComponent component(&engine);
+    component.loadUrl(testFileUrl("item.qml"));
+    QScopedPointer<QObject> object(component.create());
+    QVERIFY2(!object.isNull(), qPrintable(component.errorString()));
+
+    auto root = QAccessible::queryAccessibleInterface(object.get());
+    QVERIFY(root);
+    QCOMPARE(root->childCount(), 4);
+
+    for (int childIndex = 0; childIndex < 4; ++childIndex)
+    {
+        auto item = root->child(childIndex);
+        auto actionIface = item->actionInterface();
+        QVERIFY(actionIface);
+        auto valueIface = item->valueInterface();
+        QVERIFY(valueIface);
+
+        QVERIFY(actionIface->actionNames().contains(QAccessibleActionInterface::increaseAction()));
+        QVERIFY(actionIface->actionNames().contains(QAccessibleActionInterface::decreaseAction()));
+        QCOMPARE(valueIface->currentValue(), 25);
+        QCOMPARE(valueIface->minimumValue(), 0);
+        QCOMPARE(valueIface->maximumValue(), 100);
+
+        valueIface->setCurrentValue(30);
+        QCOMPARE(valueIface->currentValue(), 30);
+
+        const auto stepSize = valueIface->minimumStepSize();
+
+        actionIface->doAction(QAccessibleActionInterface::increaseAction());
+        QCOMPARE(valueIface->currentValue(), 30 + stepSize.toDouble());
+
+        actionIface->doAction(QAccessibleActionInterface::decreaseAction());
+        QCOMPARE(valueIface->currentValue(), 30);
+        QCOMPARE(valueIface->minimumValue(), 0);
+        QCOMPARE(valueIface->maximumValue(), 100);
+    }
+#endif
+}
+
 QTEST_MAIN(tst_accessibility)
 
 #include "tst_accessibility.moc"
