From 0d867d4a0f10e06b762213f40b63f53eff1f64ee Mon Sep 17 00:00:00 2001
From: Jan Moeller <Jan.Moeller@governikus.de>
Date: Thu, 4 Sep 2025 09:00:01 +0200
Subject: Implement QAccessibleScrollInterface in QAccessibleQuickItem

Task-number: QTBUG-139833
Change-Id: I2b81a930d22e198b5438affc126c85c9383b7b46
---
 src/quick/accessible/qaccessiblequickitem.cpp | 77 +++++++++++++++++++
 src/quick/accessible/qaccessiblequickitem_p.h | 14 +++-
 2 files changed, 90 insertions(+), 1 deletion(-)

diff --git x/qtdeclarative/src/quick/accessible/qaccessiblequickitem.cpp y/qtdeclarative/src/quick/accessible/qaccessiblequickitem.cpp
index 88e0b25ca51af9f0c99b945c91c034cb5ad09559..451a224af9004b8a48ca25254fbf4e08233f92e9 100644
--- x/qtdeclarative/src/quick/accessible/qaccessiblequickitem.cpp
+++ y/qtdeclarative/src/quick/accessible/qaccessiblequickitem.cpp
@@ -9,6 +9,8 @@
 #include "QtQuick/private/qquicktext_p.h"
 #include <private/qquicktext_p_p.h>
 
+#include "QtQuick/private/qquickflickable_p.h"
+#include "QtQuick/private/qquicklistview_p.h"
 #include "QtQuick/private/qquicktextinput_p.h"
 #include "QtQuick/private/qquickaccessibleattached_p.h"
 #include "QtQuick/qquicktextdocument.h"
@@ -698,6 +700,10 @@ void *QAccessibleQuickItem::interface_cast(QAccessible::InterfaceType t)
         return static_cast<QAccessibleTextInterface*>(this);
     }
 
+    if (t == QAccessible::ScrollInterface
+        && (r == QAccessible::ScrollBar || r == QAccessible::List))
+        return static_cast<QAccessibleScrollInterface *>(this);
+
     return QAccessibleObject::interface_cast(t);
 }
 
@@ -748,6 +754,77 @@ QVariant QAccessibleQuickItem::minimumStepSize() const
     return item()->property("stepSize");
 }
 
+qreal QAccessibleQuickItem::xPosition() const
+{
+    if (auto *flickable = qobject_cast<QQuickFlickable *>(item()))
+        return qMax(0.0, flickable->contentX());
+
+    return 0.0;
+}
+
+qreal QAccessibleQuickItem::maximumXPosition() const
+{
+    if (auto *flickable = qobject_cast<QQuickFlickable *>(item()))
+        return flickable->contentWidth();
+
+    return 0.0;
+}
+
+qreal QAccessibleQuickItem::yPosition() const
+{
+    if (auto *flickable = qobject_cast<QQuickFlickable *>(item()))
+        return qMax(0.0, flickable->contentY());
+
+    return 0.0;
+}
+
+qreal QAccessibleQuickItem::maximumYPosition() const
+{
+    if (auto *flickable = qobject_cast<QQuickFlickable *>(item()))
+        return flickable->contentHeight();
+
+    return 0.0;
+}
+
+int QAccessibleQuickItem::itemCount() const
+{
+    if (auto *listView = qobject_cast<QQuickListView *>(item()))
+        return listView->count();
+
+    return -1;
+}
+
+int QAccessibleQuickItem::fromIndex() const
+{
+    if (auto *listView = qobject_cast<QQuickListView *>(item())) {
+        // Account for overshooting and dragging over bounds
+        if (listView->orientation() == QQuickListView::Horizontal)
+            return qMax(0, listView->indexAt(listView->contentX(), 0));
+        else
+            return qMax(0, listView->indexAt(0, listView->contentY()));
+    }
+
+    return -1;
+}
+
+int QAccessibleQuickItem::toIndex() const
+{
+    if (auto *listView = qobject_cast<QQuickListView *>(item())) {
+        // Account for overshooting, dragging over bounds, and rounding errors
+        if (listView->orientation() == QQuickListView::Horizontal) {
+            const qreal x =
+                    qMin(listView->contentWidth(), listView->width() + listView->contentX());
+            return listView->indexAt(x - 1, 0);
+        } else {
+            const qreal y =
+                    qMin(listView->contentHeight(), listView->height() + listView->contentY());
+            return listView->indexAt(0, y - 1);
+        }
+    }
+
+    return -1;
+}
+
 /*!
   \internal
   Shared between QAccessibleQuickItem and QAccessibleQuickView
diff --git x/qtdeclarative/src/quick/accessible/qaccessiblequickitem_p.h y/qtdeclarative/src/quick/accessible/qaccessiblequickitem_p.h
index 50fd09a5c03d201f3a8baffbbdfa144dbf3ed656..33b4e6476c8c093767f8b4b07621988b3a1f59e3 100644
--- x/qtdeclarative/src/quick/accessible/qaccessiblequickitem_p.h
+++ y/qtdeclarative/src/quick/accessible/qaccessiblequickitem_p.h
@@ -26,7 +26,11 @@ QT_BEGIN_NAMESPACE
 
 class QTextDocument;
 
-class Q_QUICK_EXPORT QAccessibleQuickItem : public QAccessibleObject, public QAccessibleActionInterface, public QAccessibleValueInterface, public QAccessibleTextInterface
+class Q_QUICK_EXPORT QAccessibleQuickItem : public QAccessibleObject,
+                                            public QAccessibleActionInterface,
+                                            public QAccessibleValueInterface,
+                                            public QAccessibleTextInterface,
+                                            public QAccessibleScrollInterface
 {
 public:
     QAccessibleQuickItem(QQuickItem *item);
@@ -64,6 +68,14 @@ public:
     QVariant minimumValue() const override;
     QVariant minimumStepSize() const override;
 
+    // Scroll Interface
+    qreal xPosition() const override;
+    qreal maximumXPosition() const override;
+    qreal yPosition() const override;
+    qreal maximumYPosition() const override;
+    int itemCount() const override;
+    int fromIndex() const override;
+    int toIndex() const override;
 
     // Text Interface
     void selection(int selectionIndex, int *startOffset, int *endOffset) const override;
